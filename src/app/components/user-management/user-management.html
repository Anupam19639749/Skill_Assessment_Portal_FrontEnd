<div class="user-management-container">
  
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Manage Users</h1>
    <p class="page-subtitle">View and manage user accounts and permissions</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="loading-spinner"></div>
    <p>Loading users...</p>
  </div>

  <!-- Users Grid -->
  <div *ngIf="!isLoading" class="users-section">
    <div class="section-header">
      <h2 class="section-title">Candidate Users</h2>
      <div class="users-count">{{ candidateUsers.length }} users found</div>
    </div>
    
    <!-- User Cards Grid -->
    <div class="users-grid" *ngIf="candidateUsers.length > 0">
      <div 
        *ngFor="let user of candidateUsers" 
        class="user-card"
        (click)="onViewCandidateAssessments(user.userId)"
        tabindex="0"
        role="button"
        [attr.aria-label]="'View assessments for ' + user.fullName">
        
        <!-- Card Header with Profile -->
        <div class="card-header">
          <div class="profile-section">
            <div class="avatar-container">
              <img 
                *ngIf="user.profilePicturePath" 
                [src]="getUserProfilePicture(user)"
                [alt]="user.fullName + ' Profile Picture'"
                (error)="onImageError($event)"
                class="avatar-image">
              <div *ngIf="!user.profilePicturePath" class="avatar-initials">
                {{ getInitials(user) }}
              </div>
            </div>
            
            <div class="user-info">
              <h3 class="user-name">{{ user.fullName }}</h3>
              <p class="user-email">{{ user.email }}</p>
            </div>
          </div>
          
          <div class="user-status">
            <span class="role-badge" [ngClass]="getRoleBadgeClass(user.roleName)">
              {{ user.roleName }}
            </span>
          </div>
        </div>
        
        <!-- Card Body -->
        <div class="card-body">
          <div class="user-details">
            <div class="detail-item">
              <span class="detail-icon">📅</span>
              <div class="detail-content">
                <span class="detail-label">Member Since</span>
                <span class="detail-value">{{ getFormattedJoinDate(user.createdAt) }}</span>
              </div>
            </div>
            
            <div class="detail-item" *ngIf="user.currentRole">
              <span class="detail-icon">💼</span>
              <div class="detail-content">
                <span class="detail-label">Current Role</span>
                <span class="detail-value">{{ user.currentRole }}</span>
              </div>
            </div>
            
            <div class="detail-item" *ngIf="user.highestQualification">
              <span class="detail-icon">🎓</span>
              <div class="detail-content">
                <span class="detail-label">Qualification</span>
                <span class="detail-value">{{ user.highestQualification }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Click Indicator -->
        <div class="click-indicator">
          <span class="indicator-text">Click to view assessments</span>
          <span class="indicator-arrow">→</span>
        </div>
        
        <!-- Card Actions -->
        <div class="card-actions">
          <button 
            class="action-btn edit-btn" 
            title="Edit User Role"
            (click)="$event.stopPropagation(); onEditRole(user)">
            <span class="btn-icon">✏️</span>
            <span class="btn-text">Edit Role</span>
          </button>
          
          <button 
            class="action-btn delete-btn" 
            title="Delete User"
            (click)="$event.stopPropagation(); onDelete(user.userId)">
            <span class="btn-icon">🗑️</span>
            <span class="btn-text">Delete</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="candidateUsers.length === 0" class="empty-state">
      <div class="empty-icon">👥</div>
      <h3 class="empty-title">No candidate users found</h3>
      <p class="empty-text">There are currently no users with the candidate role in the system.</p>
    </div>
  </div>

  <!-- Edit Form Modal -->
  <div *ngIf="isEditMode" class="edit-modal-overlay" (click)="resetEditMode()">
    <div class="edit-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Edit User Role</h3>
        <button class="close-btn" (click)="resetEditMode()">✕</button>
      </div>
      
      <div class="modal-body">
        <div *ngIf="selectedUser" class="user-preview">
          <div class="preview-avatar">
            <img 
              *ngIf="selectedUser.profilePicturePath" 
              [src]="getUserProfilePicture(selectedUser)"
              [alt]="selectedUser.fullName + ' Profile Picture'"
              (error)="onImageError($event)">
            <div *ngIf="!selectedUser.profilePicturePath" class="preview-initials">
              {{ getInitials(selectedUser) }}
            </div>
          </div>
          <div class="preview-info">
            <h4>{{ selectedUser.fullName }}</h4>
            <p>{{ selectedUser.email }}</p>
          </div>
        </div>
        
        <form [formGroup]="userForm" (ngSubmit)="onUpdateRole()" class="edit-form">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input 
              type="text" 
              class="form-input disabled"
              formControlName="fullName"
              readonly>
          </div>
          
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input 
              type="email" 
              class="form-input disabled"
              formControlName="email"
              readonly>
          </div>
          
          <div class="form-group">
            <label class="form-label">New Role</label>
            <select class="form-select" formControlName="roleId">
              <option value="">Select new role</option>
              <option *ngFor="let role of roles" [value]="role.roleId">
                {{ role.roleName }}
              </option>
            </select>
            <div *ngIf="userForm.get('roleId')?.invalid && userForm.get('roleId')?.touched" 
                 class="error-text">
              Please select a role
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="resetEditMode()">
          Cancel
        </button>
        <button 
          type="button" 
          class="btn-primary" 
          [disabled]="userForm.invalid"
          (click)="onUpdateRole()">
          Update Role
        </button>
      </div>
    </div>
  </div>

</div>